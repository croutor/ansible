# written on ansible 2.3.2.0
---
    ###################
    # User Management
    ###################
    - name: Create user {{ users.user1.name }}
      user: name={{ users.user1.name }}
            comment="{{ users.user1.name }} user"
            shell=/bin/bash

#    - name: Add {{ user }} to sudoers
#      template: src=templates/sudoers-user.j2
#                dest=/etc/sudoers.d/{{ users.user1.name }}-sudoer
#                validate='visudo -cf %s'

#    - name: Add my public key to {{ user }}
#      authorized_key: user={{ users.user1.name }}
#                      key="{{ lookup('file', '~/.ssh/id_rsa.pub') }}"

    ###################
    # Time management
    ###################
    - name: Set local timezone
      timezone:
              name={{ local.timezone }}

    ###################
    # Debian packages
    ###################
    - name: Install Debian packages
      package: name={{ item }} state=latest
      with_items:
        - build-essential
        - ddd
        - esmtp
        - git
        - gitg
        - htop
        - meld
        - mutt
        - python-pip
        - shellcheck
        - subversion
        - sudo
        - terminator
        - tree
        - valgrind
        - vim

    ###################
    # Python / Virtualenv
    ###################
    - name: Install virtualenv
      pip: name=virtualenv

    ###################
    # Google Chrome
    ###################
    - name: Does the Google apt file exist?
      command: test -f {{apt.chrome_source_file}}
      register: google_apt_exists
      ignore_errors: True

    - name: Add Google Chrome key
      shell: wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -
      when: google_apt_exists.rc == 1

    - name: Add Google Chrome repo
      copy: content="deb http://dl.google.com/linux/chrome/deb/ stable main" dest={{apt_file}} owner=root group=root mode=644
      when: google_apt_exists.rc == 1

    - name: Update apt cache
      apt: update_cache=yes
      when: google_apt_exists.rc == 1

    - name: Install Google Chrome
      apt: pkg=google-chrome-stable state=installed

    ###################  
    # Dropbox
    ###################
    - name: Download Dropbox
      get_url: url="{{apt.dropbox_url}}"
               dest="/tmp/{{apt.dropbox_package}}"

    - name: Install Dropbox
      apt:  deb="/tmp/{{apt.dropbox_package}}"
            state=present

    - name: Download Dropbox daemon
      shell: cd ~ && wget -O - "https://www.dropbox.com/download?plat=lnx.x86_64" | tar xzf -
      become: true
      become_user: "{{users.user1.name}}"

    - name: Start Dropbox daemon
      shell: ~/.dropbox-dist/dropboxd
      become: true
      become_user: "{{users.user1.name}}"

    ###################
    # Vim config
    ###################
    - name: Vim configuration
      copy: src=.vimrc
            dst=/home/{{users.user1.name}}/.vimrc
            owner="{{users.user1.name}}"
            group="{{users.user1.name}}"

    ###################
    # mutt config
    ###################
    - template:
           src=.muttrc.j2
           dst=/home/{{users.user1.name}}/.muttrc
           owner="{{users.user1.name}}"
           group="{{users.user1.name}}"
           mode=0600

  ###################

